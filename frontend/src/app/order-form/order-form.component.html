<div class="order-form-container">
  <!-- Hueber Header with Logo -->
  <div class="hueber-header">
    <div class="logo-container">
      <h1 class="hueber-logo">HUEBER</h1>
      <h2 class="header-subtitle">Hueber Interaktiv Sipariş - Hueber Interaktiv Bestellung</h2>
    </div>
  </div>

  <mat-card class="form-card">
    <!-- Introduction Text -->
    <div class="intro-section">
      <p class="intro-text">
        <strong>Sevgili Öğretmenim,</strong><br><br>
        Yeni Hueber Interaktiv uygulamamızı ücretsiz sipariş vermeniz için lütfen aşağıda ki bilgileri doldurunuz. 
        Doldurduğunuz bu forma ait siparişleriniz en geç bir hafta içerisinde tarafınıza mail olarak ulaşacaktır. 
        Bu kodlar üç sene geçerli olacaktır. Bir hafta sonra kodlar mailinize gelmediyse lütfen aşağıda ki numaradan bizlere ulaşınız.<br><br>
        <em>*Sadece derste kullandığınız kitapların kodları gönderilecektir.</em><br><br>
        <strong>Saygılarımızla,</strong><br>
        <strong>Hueber Team</strong><br>
        Nurten Karadağ - 0552 614 58 57<br>
        Merve Baycan - 0541 614 58 57
      </p>
    </div>

    <mat-card-content>
      <form [formGroup]="orderForm" *ngIf="!showSummary">
        <!-- Form Fields -->
        <div class="form-section">
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Ad-Soyad / Name-Nachname *</mat-label>
              <input matInput formControlName="fullName" placeholder="Adınızı ve soyadınızı giriniz">
              <mat-error *ngIf="fullName?.hasError('required')">
                Ad-Soyad zorunludur
              </mat-error>
              <mat-error *ngIf="fullName?.hasError('minlength')">
                Ad-Soyad en az 3 karakter olmalıdır
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>E-posta / E-Mail *</mat-label>
              <input matInput formControlName="email" placeholder="ornek@email.com" type="email">
              <mat-error *ngIf="email?.hasError('required')">
                E-posta zorunludur
              </mat-error>
              <mat-error *ngIf="email?.hasError('email')">
                Geçerli bir e-posta adresi giriniz
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Telefon Numarası / Telefonnummer *</mat-label>
              <input matInput formControlName="phone" placeholder="05XX XXX XX XX" type="tel">
              <mat-error *ngIf="phone?.hasError('required')">
                Telefon numarası zorunludur
              </mat-error>
              <mat-error *ngIf="phone?.hasError('pattern')">
                Geçerli bir telefon numarası giriniz (10-11 haneli)
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Okul ve Kampüs / Schule und Kampus *</mat-label>
              <input matInput formControlName="school" placeholder="Okul ve kampüs adınızı giriniz">
              <mat-error *ngIf="school?.hasError('required')">
                Okul ve kampüs zorunludur
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Şehir / Stadt *</mat-label>
              <input matInput formControlName="city" placeholder="Şehir adınızı giriniz">
              <mat-error *ngIf="city?.hasError('required')">
                Şehir zorunludur
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Working Books Section -->
        <div class="form-section">
          <h3 class="section-title">
            Hangi ders kitaplarıyla çalışıyorsunuz? / Mit welchen Lehrwerken arbeiten Sie? *
          </h3>
          
          <mat-form-field appearance="outline" class="form-field full-width">
            <mat-label>Örnek: Beste Freunde 1,2,3 - Schritte International Neu 1 und 2</mat-label>
            <textarea 
              matInput 
              formControlName="workingBooks" 
              placeholder="z.B. Beste Freunde 1,2,3 - Schritte International Neu 1 und 2"
              rows="3"></textarea>
            <mat-error *ngIf="workingBooks?.hasError('required')">
              Bu alan zorunludur
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Selected Books Section -->
        <div class="form-section">
          <h3 class="section-title">
            Aşağıda ki kitapların interaktif kodlarına ihtiyacım var: / Ich brauche die interaktiven Codes zu folgenden Lehrwerken: *
          </h3>
          
          <div class="books-grid">
            <mat-card class="book-card" *ngFor="let book of books">
              <div class="book-image-container">
                <img [src]="book.imageUrl" [alt]="book.name" class="book-image" (error)="onImageError($event)">
                <div class="book-level-badge">{{ book.level }}</div>
              </div>
              <mat-checkbox 
                [checked]="book.selectedForCodes"
                (change)="onBookChange(book, $event)"
                color="accent"
                class="book-checkbox">
                <span class="book-name">{{ book.name }}</span>
              </mat-checkbox>
            </mat-card>
          </div>
        </div>

        <div class="form-actions">
          <button 
            mat-raised-button 
            color="primary" 
            (click)="onSubmit()"
            [disabled]="orderForm.invalid || selectedBooksFormArray.length === 0"
            class="submit-button">
            Devam Et / Weiter
          </button>
        </div>
      </form>

      <!-- Özet Ekranı -->
      <div *ngIf="showSummary" class="summary-section">
        <h3 class="summary-title">
          Sipariş Özeti / Bestellübersicht
        </h3>

        <mat-card class="summary-card">
          <mat-card-content>
            <div class="summary-item">
              <div class="summary-content">
                <strong>Ad-Soyad / Name-Nachname:</strong>
                <span>{{ orderForm.value.fullName }}</span>
              </div>
            </div>

            <div class="summary-item">
              <div class="summary-content">
                <strong>E-posta / E-Mail:</strong>
                <span>{{ orderForm.value.email }}</span>
              </div>
            </div>

            <div class="summary-item">
              <div class="summary-content">
                <strong>Telefon Numarası / Telefonnummer:</strong>
                <span>{{ orderForm.value.phone }}</span>
              </div>
            </div>

            <div class="summary-item">
              <div class="summary-content">
                <strong>Okul ve Kampüs / Schule und Kampus:</strong>
                <span>{{ orderForm.value.school }}</span>
              </div>
            </div>

            <div class="summary-item">
              <div class="summary-content">
                <strong>Şehir / Stadt:</strong>
                <span>{{ orderForm.value.city }}</span>
              </div>
            </div>

            <mat-divider></mat-divider>

            <div class="summary-item">
              <div class="summary-content">
                <strong>Hangi ders kitaplarıyla çalışıyorsunuz? / Mit welchen Lehrwerken arbeiten Sie?</strong>
                <span>{{ orderForm.value.workingBooks }}</span>
              </div>
            </div>

            <mat-divider></mat-divider>

            <div class="summary-item books-summary">
              <div class="summary-content">
                <strong>Seçilen Kitaplar / Ausgewählte Lehrwerke:</strong>
                <mat-list class="books-list">
                  <mat-list-item *ngFor="let bookName of getSelectedBookNames()">
                    <div matLine>{{ bookName }}</div>
                  </mat-list-item>
                </mat-list>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <div class="summary-actions">
          <button 
            mat-stroked-button 
            color="primary" 
            (click)="onBack()"
            class="back-button">
            Geri Dön / Zurück
          </button>
          <button 
            mat-raised-button 
            color="primary" 
            (click)="onConfirm()"
            class="confirm-button">
            Onayla / Bestätigen
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
