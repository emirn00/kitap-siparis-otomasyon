<div class="admin-container">
  <!-- Header -->
  <div class="hueber-header">
    <div class="logo-container">
      <h1 class="hueber-logo">HUEBER</h1>
      <h2 class="header-subtitle">Asistan / Assistent</h2>
      <a routerLink="/admin" class="help-link">Admin Ana Sayfa / Admin Startseite</a>
    </div>
  </div>

  <mat-card class="form-card">
    <mat-card-content>
      <div class="chatbot-header">
        <div class="header-info">
          <h2 class="section-title">Yapay Zeka Destekli Asistan / KI-gestützter Assistent</h2>
          <p class="section-description">
            Sipariş yönetimi, kullanıcı desteği ve sistem analizi konularında yardım alın.
            / Erhalten Sie Hilfe bei der Bestellungsverwaltung, Benutzerunterstützung und Systemanalyse.
          </p>
        </div>
        <div class="header-actions">
          <button mat-icon-button (click)="clearChat()" matTooltip="Sohbeti Temizle / Chat löschen" class="action-icon-btn">
            <span class="icon-text">Temizle</span>
          </button>
        </div>
      </div>

      <div class="chatbot-container">
        <!-- Sidebar -->
        <div class="chatbot-sidebar">
          <!-- Search -->
          <div class="sidebar-section">
            <mat-form-field appearance="outline" class="search-field">
              <mat-label>Mesajlarda Ara / In Nachrichten suchen</mat-label>
              <input matInput [(ngModel)]="searchTerm" [ngModelOptions]="{ standalone: true }" placeholder="Ara...">
            </mat-form-field>
          </div>

          <!-- Categories -->
          <div class="sidebar-section">
            <h3 class="sidebar-title">Kategoriler / Kategorien</h3>
            <div class="category-list">
              <button 
                *ngFor="let cat of categories"
                class="category-btn"
                [class.active]="selectedCategory === cat.value"
                (click)="filterByCategory(cat.value)">
                <span class="category-label">{{ cat.label }}</span>
              </button>
            </div>
          </div>

          <!-- Quick Suggestions -->
          <div class="sidebar-section">
            <h3 class="sidebar-title">Hızlı Öneriler / Schnellvorschläge</h3>
            <div class="quick-suggestions">
              <button 
                *ngFor="let suggestion of quickSuggestions"
                class="suggestion-btn"
                (click)="quickAction(suggestion.action)">
                <span class="suggestion-text">{{ suggestion.text }}</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Main Chat Area -->
        <div class="chatbot-main">
          <!-- Chat Messages -->
          <div class="chat-messages-container" #chatMessages>
            <div class="messages-wrapper">
              <div 
                *ngFor="let message of searchFilteredMessages; trackBy: trackByMessageId"
                class="message-wrapper"
                [class.user-msg-wrapper]="message.type === 'user'"
                [class.assistant-msg-wrapper]="message.type === 'assistant'">
                
                <!-- Date Separator -->
                <div *ngIf="shouldShowDateSeparator(message)" class="date-separator">
                  <span>{{ formatDate(message.timestamp) }}</span>
                </div>

                <div class="message-bubble" [class.user-bubble]="message.type === 'user'" [class.assistant-bubble]="message.type === 'assistant'">
                  <div class="message-header">
                    <span class="message-sender">
                      {{ message.type === 'user' ? 'Siz / Sie' : 'Asistan / Assistent' }}
                    </span>
                    <div class="message-actions">
                      <button 
                        mat-icon-button 
                        (click)="copyMessage(message.content)"
                        matTooltip="Kopyala / Kopieren"
                        class="msg-action-btn">
                        <span class="icon-text">Kopyala</span>
                      </button>
                      <button 
                        *ngIf="message.type === 'user'"
                        mat-icon-button 
                        (click)="deleteMessage(message.id)"
                        matTooltip="Sil / Löschen"
                        class="msg-action-btn delete-btn">
                        <span class="icon-text">Sil</span>
                      </button>
                    </div>
                  </div>
                  
                  <div class="message-body">
                    <div class="message-text" [innerHTML]="formatMessageContent(message.content)"></div>
                    <span class="message-time">{{ formatTime(message.timestamp) }}</span>
                  </div>

                  <!-- Suggestions -->
                  <div *ngIf="message.suggestions && message.suggestions.length > 0 && message.type === 'assistant'" class="message-suggestions">
                    <div class="suggestions-label">Öneriler / Vorschläge:</div>
                    <div class="suggestions-list">
                      <button 
                        *ngFor="let suggestion of message.suggestions"
                        class="suggestion-chip"
                        (click)="useSuggestion(suggestion)">
                        {{ suggestion }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Typing Indicator -->
              <div *ngIf="isTyping" class="typing-indicator">
                <div class="typing-dots">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
                <span class="typing-text">Asistan yazıyor... / Assistent schreibt...</span>
              </div>
            </div>
          </div>

          <!-- Chat Input -->
          <div class="chat-input-container">
            <div class="input-wrapper">
              <textarea
                #messageInput
                [(ngModel)]="userMessage"
                [ngModelOptions]="{ standalone: true }"
                (keydown)="onEnterKey($event)"
                placeholder="Mesajınızı yazın... / Schreiben Sie Ihre Nachricht..."
                class="message-textarea"
                rows="1"></textarea>
              <div class="input-actions">
                <button 
                  mat-raised-button 
                  color="primary" 
                  (click)="sendMessage()"
                  [disabled]="!userMessage.trim() || isTyping"
                  class="send-btn">
                  <span>Gönder / Senden</span>
                </button>
              </div>
            </div>
            <div class="input-hint">
              Enter tuşu ile gönder, Shift+Enter ile yeni satır / Mit Enter senden, mit Shift+Enter neue Zeile
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
