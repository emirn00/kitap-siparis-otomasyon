<div class="admin-container">
  <!-- Header -->
  <div class="hueber-header">
    <div class="logo-container">
      <h1 class="hueber-logo">HUEBER</h1>
      <h2 class="header-subtitle">{{ 'assistantSubtitle' | translate }}</h2>
      <a routerLink="/admin" class="help-link">{{ 'adminHome' | translate }}</a>
    </div>
  </div>

  <mat-card class="form-card">
    <mat-card-content>
      <div class="chatbot-header">
        <div class="header-info">
          <h2 class="section-title">{{ 'assistantSectionTitle' | translate }}</h2>
          <p class="section-description">
            {{ 'assistantSectionDesc' | translate }}
          </p>
        </div>
        <div class="header-actions">
          <button mat-icon-button (click)="clearChat()" [attr.title]="'clearChat' | translate" class="action-icon-btn">
            <span class="icon-text">{{ 'clearChat' | translate }}</span>
          </button>
        </div>
      </div>

      <div class="chatbot-container">
        <!-- Sidebar -->
        <div class="chatbot-sidebar">
          <div class="sidebar-section">
            <mat-form-field appearance="outline" class="search-field">
              <mat-label>{{ 'searchMessages' | translate }}</mat-label>
              <input matInput [(ngModel)]="searchTerm" [ngModelOptions]="{ standalone: true }" [placeholder]="'searchPlaceholderShort' | translate">
            </mat-form-field>
          </div>

          <div class="sidebar-section">
            <h3 class="sidebar-title">{{ 'categories' | translate }}</h3>
            <div class="category-list">
              <button 
                *ngFor="let cat of categories"
                class="category-btn"
                [class.active]="selectedCategory === cat.value"
                (click)="filterByCategory(cat.value)">
                <span class="category-label">{{ cat.labelKey | translate }}</span>
              </button>
            </div>
          </div>

          <div class="sidebar-section">
            <h3 class="sidebar-title">{{ 'quickSuggestions' | translate }}</h3>
            <div class="quick-suggestions">
              <button 
                *ngFor="let suggestion of quickSuggestions"
                class="suggestion-btn"
                (click)="quickAction(suggestion.action)">
                <span class="suggestion-text">{{ suggestion.textKey | translate }}</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Main Chat Area -->
        <div class="chatbot-main">
          <div class="chat-messages-container" #chatMessages>
            <div class="messages-wrapper">
              <div 
                *ngFor="let message of searchFilteredMessages; trackBy: trackByMessageId"
                class="message-wrapper"
                [class.user-msg-wrapper]="message.type === 'user'"
                [class.assistant-msg-wrapper]="message.type === 'assistant'">
                
                <div *ngIf="shouldShowDateSeparator(message)" class="date-separator">
                  <span>{{ formatDate(message.timestamp) }}</span>
                </div>

                <div class="message-bubble" [class.user-bubble]="message.type === 'user'" [class.assistant-bubble]="message.type === 'assistant'">
                  <div class="message-header">
                    <span class="message-sender">
                      {{ message.type === 'user' ? ('you' | translate) : ('assistantName' | translate) }}
                    </span>
                    <div class="message-actions">
                      <button 
                        mat-icon-button 
                        (click)="copyMessage(message.content)"
                        [attr.title]="'copy' | translate"
                        class="msg-action-btn">
                        <span class="icon-text">{{ 'copy' | translate }}</span>
                      </button>
                      <button 
                        *ngIf="message.type === 'user'"
                        mat-icon-button 
                        (click)="deleteMessage(message.id)"
                        [attr.title]="'deleteMsg' | translate"
                        class="msg-action-btn delete-btn">
                        <span class="icon-text">{{ 'deleteMsg' | translate }}</span>
                      </button>
                    </div>
                  </div>
                  
                  <div class="message-body">
                    <div class="message-text" [innerHTML]="formatMessageContent(message.content)"></div>
                    <span class="message-time">{{ formatTime(message.timestamp) }}</span>
                  </div>

                  <div *ngIf="message.suggestions && message.suggestions.length > 0 && message.type === 'assistant'" class="message-suggestions">
                    <div class="suggestions-label">{{ 'suggestions' | translate }}:</div>
                    <div class="suggestions-list">
                      <button 
                        *ngFor="let suggestion of message.suggestions"
                        class="suggestion-chip"
                        (click)="useSuggestion(suggestion)">
                        {{ suggestion }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div *ngIf="isTyping" class="typing-indicator">
                <div class="typing-dots">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
                <span class="typing-text">{{ 'typing' | translate }}</span>
              </div>
            </div>
          </div>

          <div class="chat-input-container">
            <div class="input-wrapper">
              <textarea
                #messageInput
                [(ngModel)]="userMessage"
                [ngModelOptions]="{ standalone: true }"
                (keydown)="onEnterKey($event)"
                [placeholder]="'messagePlaceholder' | translate"
                class="message-textarea"
                rows="1"></textarea>
              <div class="input-actions">
                <button 
                  mat-raised-button 
                  color="primary" 
                  (click)="sendMessage()"
                  [disabled]="!userMessage.trim() || isTyping"
                  class="send-btn">
                  <span>{{ 'send' | translate }}</span>
                </button>
              </div>
            </div>
            <div class="input-hint">
              {{ 'sendHint' | translate }}
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
