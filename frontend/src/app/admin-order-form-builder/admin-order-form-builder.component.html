<div class="admin-container">
  <div class="hueber-header">
    <div class="logo-container">
      <h1 class="hueber-logo">HUEBER</h1>
      <h2 class="header-subtitle">Sipariş Formu Oluştur / Bestellformular erstellen</h2>
      <a routerLink="/admin" class="help-link">Admin Ana Sayfa / Admin Startseite</a>
    </div>
  </div>

  <mat-card class="form-card">
    <mat-card-content>
      <h2 class="section-title">Bestellung Hueber iV Lizenzen – Formular</h2>
      <p class="section-description">
        Head (head.csv) sabit; siparişlerdeki toplam kitap sayıları hesaplanır, Formular Bestellung Digitallizenzen formatında önizleme ve Excel indirilir.
      </p>

      <div *ngIf="downloadSuccess" class="alert alert-success">
        <span>{{ downloadSuccess }}</span>
      </div>

      <div class="create-section" *ngIf="!previewReady">
        <button mat-raised-button color="primary" type="button" (click)="createOrderForm()" class="create-btn">
          Sipariş Formu Oluştur / Bestellformular erstellen
        </button>
        <p class="create-hint">Mock sipariş verilerinden toplamlar hesaplanır ve önizleme gösterilir.</p>
      </div>

      <div class="preview-section" *ngIf="previewReady">
        <div class="preview-header">
          <h3 class="subsection-title">Önizleme – Formular Bestellung Digitallizenzen</h3>
          <div class="preview-actions">
            <button mat-raised-button color="primary" type="button" (click)="downloadExcel()" class="download-btn">
              Excel İndir / Excel herunterladen
            </button>
            <button mat-button type="button" (click)="closePreview()">
              Önizlemeyi Kapat / Vorschau schließen
            </button>
          </div>
        </div>

        <div class="order-form-preview">
          <table class="order-preview-table">
            <thead>
              <tr *ngFor="let row of headRows; let i = index" [class.header-row]="i < headRows.length - 1" [class.column-headers]="i === headRows.length - 1">
                <td *ngFor="let cell of row">{{ cell }}</td>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of bookTotals">
                <td class="cell-num">{{ row.quantity }}</td>
                <td class="cell-num">1</td>
                <td>3 jahre</td>
                <td class="cell-code">{{ row.code }}</td>
                <td>kostenlos</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
