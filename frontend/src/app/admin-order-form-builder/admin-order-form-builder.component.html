<div class="admin-container">
  <div class="hueber-header">
    <div class="logo-container">
      <h1 class="hueber-logo">HUEBER</h1>
      <h2 class="header-subtitle">{{ 'orderFormBuilderSubtitle' | translate }}</h2>
      <a routerLink="/admin" class="help-link">{{ 'adminHome' | translate }}</a>
    </div>
  </div>

  <mat-card class="form-card">
    <mat-card-content>
      <h2 class="section-title">Bestellung Hueber iV Lizenzen – Formular</h2>
      <p class="section-description">
        {{ 'formBuilderSectionDesc' | translate }}
      </p>

      <div *ngIf="downloadSuccess" class="alert alert-success">
        <span>{{ downloadSuccess }}</span>
      </div>

      <div *ngIf="error" class="alert alert-error">
        <span>{{ error }}</span>
      </div>

      <div class="date-selection-section">
        <mat-form-field appearance="outline" class="date-range-field">
          <mat-label>{{ 'dateRangeLabel' | translate }}</mat-label>
          <mat-date-range-input [rangePicker]="picker">
            <input matStartDate [(ngModel)]="startDate" [placeholder]="'startPlaceholder' | translate" (dateChange)="onDateChange()">
            <input matEndDate [(ngModel)]="endDate" [placeholder]="'endPlaceholder' | translate" (dateChange)="onDateChange()">
          </mat-date-range-input>
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>

        <div class="date-info">
          <p *ngIf="startDate && endDate">
            <strong>{{ 'currentFilterDesc' | translate }}</strong>
            <br>
            <span class="date-range-text">({{ startDate | date:'dd.MM.yyyy' }} – {{ endDate | date:'dd.MM.yyyy'
              }})</span>
          </p>
        </div>

        <div *ngIf="loading" class="loading-indicator">
          <mat-spinner diameter="20"></mat-spinner>
          <span>{{ 'loading' | translate }}</span>
        </div>
      </div>

      <div class="preview-section" *ngIf="previewReady">
        <div class="preview-header">
          <h3 class="subsection-title">{{ 'preview' | translate }}</h3>
          <div class="preview-actions">
            <button mat-raised-button color="primary" type="button" (click)="downloadExcel()" class="download-btn">
              {{ 'downloadExcel' | translate }}
            </button>
          </div>
        </div>

        <div class="order-form-preview">
          <table class="order-preview-table">
            <thead>
              <tr *ngFor="let row of headRows; let i = index" [class.header-row]="i < headRows.length - 1"
                [class.column-headers]="i === headRows.length - 1">
                <td *ngFor="let cell of row">{{ cell }}</td>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of bookTotals">
                <td class="cell-num">{{ row.quantity }}</td>
                <td class="cell-num">1</td>
                <td>3 jahre</td>
                <td class="cell-code">{{ row.code }}</td>
                <td>kostenlos</td>
              </tr>
              <tr *ngIf="bookTotals.length === 0">
                <td colspan="5" class="no-data">{{ 'noOrdersInRange' | translate }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
